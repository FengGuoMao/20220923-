DROP TABLE wf.ads_ewokb_dq
CREATE TABLE    wf.ads_ewokb_dq (
id INTEGER,
REQUESTID INTEGER,
EWO		 VARCHAR(124),
PMN_MAIN_MRNUMBER  VARCHAR(255),
PMN_MAIN_PREPARER VARCHAR(255),
PMN_MAIN_DREBM 	VARCHAR(255),
CENTER   VARCHAR(255),
SUOSHUXM	 VARCHAR(124),
PMN_MAIN_XIUGLB  VARCHAR(124),
NODENAME VARCHAR(255),
PMN_MAIN_WRITEDATE VARCHAR(124),
LASTOPERATEDATE	 VARCHAR(124),
PMN_MAIN_DUANDZRR VARCHAR(1400),
PMN_MAIN_GUANLIAN VARCHAR(1400),
PMN_MAIN_SHIJIDDSJ char(50),
PMN_WLQD_NUMBER  VARCHAR(1400),
PMN_WLQD_WLTH_PRP VARCHAR(1400),
PMN_WLQD_POS  VARCHAR(255),
PMN_WLQD_MIAOSHU VARCHAR(500),
CHENGSHUD   VARCHAR(255),
PMN_WLQD_TUZHISHENGJ  VARCHAR(1400),
PMN_WLQD_TUYANGBBHK  VARCHAR(1400),
CHA1 VARCHAR(1400),
FOR1 VARCHAR(1400),
PMN_WLQD_ZZPCLYJ INTEGER,
PMN_WLQD_HUHUANX INTEGER,
ETR INTEGER,
PMN_WLQD_EBOMWCQK_NEW VARCHAR(1400),
GENGGAIQESO INTEGER,
SHUMOFBJH VARCHAR  (1400),
PMN_WLQD_DDJHWCRQ  VARCHAR(100),
SORFABSJ	VARCHAR(255),
SORFABSJ2	VARCHAR(255),
SORRELEASEACTUALTIME	TIMESTAMP,
SORRELEASEACTUALTIME2 	VARCHAR(255), --5/12 去掉该字段
SORCONDITION    VARCHAR(255),
SHANGWUDDJHWCSJ 	VARCHAR(255),
SHANGWUDDJHWCSJ2	VARCHAR(255),
FIXEDPOINTACTUALTIME	TIMESTAMP,
FIXEDPOINTACTUALTIME2 VARCHAR(255), -- 5/12 待定是否去掉
FIXECONDITION   VARCHAR(255),
ESOPIZJHWCSJ 	VARCHAR(255),
ESOPIZJHWCSJ2	VARCHAR(255),
OTSAPPROVALACTUALTIME	TIMESTAMP,
OTSAPPROVALACTUALTIME2 	VARCHAR(255),
OTSCONDITION   VARCHAR(255),
PPAPJIHWCSJ		VARCHAR(255),
PPAPJIHWCSJ2	VARCHAR(255),
PPAPACTUALTIME TIMESTAMP,
PPAPACTUALTIME2 VARCHAR(255),
PPAPCONDITION  VARCHAR(255)
)
;
CREATE TABLE  wf.ads_ewokb_dq  AS (
INSERT INTO   wf.ads_ewokb_dq
SELECT ID, REQUESTID, EWO, PMN_MAIN_MRNUMBER, PMN_MAIN_PREPARER, PMN_MAIN_DREBM, CENTER, SUOSHUXM, PMN_MAIN_XIUGLB, "NODENAME", PMN_MAIN_WRITEDATE, LASTOPERATEDATE, PMN_MAIN_DUANDZRR,PMN_MAIN_GUANLIAN, PMN_MAIN_SHIJIDDSJ, PMN_WLQD_NUMBER, PMN_WLQD_WLTH_PRP, PMN_WLQD_POS, PMN_WLQD_MIAOSHU, CHENGSHUD, PMN_WLQD_TUZHISHENGJ, PMN_WLQD_TUYANGBBHK, CHA1, FOR1, PMN_WLQD_ZZPCLYJ, PMN_WLQD_HUHUANX, ETR, PMN_WLQD_EBOMWCQK_NEW, GENGGAIQESO, SHUMOFBJH, PMN_WLQD_DDJHWCRQ, SORFABSJ, SORFABSJ2, SORRELEASEACTUALTIME, SORRELEASEACTUALTIME2,  SHANGWUDDJHWCSJ, SHANGWUDDJHWCSJ2, FIXEDPOINTACTUALTIME, FIXEDPOINTACTUALTIME2, ESOPIZJHWCSJ, ESOPIZJHWCSJ2, OTSAPPROVALACTUALTIME, OTSAPPROVALACTUALTIME2, PPAPJIHWCSJ, PPAPJIHWCSJ2, PPAPACTUALTIME
, PPAPACTUALTIME2
,CASE
	  WHEN ppapjihwcsj2 IN( '不涉及','') THEN '不涉及'
	  WHEN PPAPActualTime IS NOT NULL  THEN '已完成'
	  WHEN ppapjihwcsj2 < replace(substr(To_char(SYSDATE,'YYYY-MM-DD HH24:MI:SS'),1,10),'-','') THEN '拖期进行中'
	  WHEN ppapjihwcsj2 >= replace(substr(To_char(SYSDATE,'YYYY-MM-DD HH24:MI:SS'),1,10),'-','') THEN '进行中'
	  ELSE '其他'  END AS PPAPCONDITION
,CASE
	  WHEN esopizjhwcsj2 IN( '不涉及','') THEN '不涉及'
	  WHEN OTSApprovalActualTime  IS NOT NULL THEN '已完成'
	  WHEN esopizjhwcsj2 <  TO_CHAR((CURRENT_DATE),'YYYYMMDD') THEN '拖期进行中'
	  WHEN esopizjhwcsj2 >=  TO_CHAR((CURRENT_DATE),'YYYYMMDD') THEN '进行中'
	  ELSE '其他'  END AS OTSCONDITION -- ESO归档状态  sheet19
,CASE
	  WHEN SORFABSJ2 IN( '不涉及','') THEN '不涉及'
	  WHEN SORRELEASEACTUALTIME IS NOT NULL THEN '已完成'
	  WHEN SORFABSJ2 < TO_CHAR((CURRENT_DATE),'YYYYMMDD')  THEN '拖期进行中'
	  WHEN SORFABSJ2 >= TO_CHAR((CURRENT_DATE),'YYYYMMDD')  THEN '进行中'
	  ELSE '其他'  END AS  SORCONDITION  --  SOR状态  sheet16
,CASE
	  WHEN shangwuddjhwcsj2 IN( '不涉及','') THEN '不涉及'
	  WHEN FixedPointActualTime IS NOT NULL THEN '已完成'
	  WHEN shangwuddjhwcsj2 < TO_CHAR((CURRENT_DATE),'YYYYMMDD')  THEN '拖期进行中'
	  WHEN shangwuddjhwcsj2 >= TO_CHAR((CURRENT_DATE),'YYYYMMDD')  THEN '进行中'
	  ELSE '其他'  END AS  FIXECONDITION  -- 商务定点状态  sheet16
FROM wf.tmp_ewo_dq
) DEFINITION  ONLY

pmn_main
 SELECT * FROM wf.ADS_EWOKB_DQ    WHERE LASTOPERATEDATE >= '2023-04-04'
